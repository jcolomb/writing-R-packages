<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>An Introduction to Writing R Packages</title>
    <meta charset="utf-8" />
    <meta name="author" content="Hao Ye" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">




class: inverse, center, middle

# An Introduction to Writing R Packages
### Hao Ye
### Health Science Center Libraries, University of Florida
### (updated: 2021-02-16)

---
# Motivations

R packages are the primary means of bundling R code and facilitate many use cases, including:

* re-using code or data across projects
* writing open source software
* creating reproducible analyses

---
# Learning Outcomes

By the end of the workshop, participants will be able to:
* create functional R packages
* write documentation using `roxygen2`
* describe additional package-related tools (e.g. `pkgdown`, `testthat`)

---
class: inverse, center, middle

# Creating R Packages

---
# Setup

Before getting started, we want some tools that help make creating packages easier.


```r
install.packages(c("devtools", "roxygen2", 
                   "testthat", "knitr"))
```

---
# Creating a new R package


```r
devtools::create("myDemoPkg")
```
&lt;pre class = "hljs remark-code"&gt;
myDemoPkg
├── .gitignore
├── .Rbuildignore
├── DESCRIPTION
├── myDemoPkg.Rproj
├── NAMESPACE
└── R/
&lt;/pre&gt;
* package names have to start with a letter and can only contain letters, numbers, and periods.

---
# What are these files?

* `.gitignore` tells git to NOT track certain files
* `.Rbuildignore` tells R to NOT include certain files when building the package
* `DESCRIPTION` contains basic metadata about the package
* `myDemoPkg.Rproj` is the RStudio project
* `NAMESPACE` lists the objects that are loaded with the package
* `R/` contains R function definitions

---
# Building the Package

* R Console

```r
devtools::install()
```

.center[OR]

* RStudio Build Pane
&lt;img src="rstudio_build.png" title="A cropped screenshot of the 'Build' Pane in the RStudio interface, showing a panel with tabs for 'Plots', 'Packages', 'Help, 'Build', and 'Viewer' on the left and buttons with the minimize and maximize icons on the right. The 'Build' tab is selected, showing 3 additional buttons at the top of the tab: 'Install and Restart' (with a hammer icon), 'Check' (with a checklist icon), and 'More' (with a gear icon and an arrow indicating a pulldown menu). There is a magenta oval around the 'Install and Restart' button." alt="A cropped screenshot of the 'Build' Pane in the RStudio interface, showing a panel with tabs for 'Plots', 'Packages', 'Help, 'Build', and 'Viewer' on the left and buttons with the minimize and maximize icons on the right. The 'Build' tab is selected, showing 3 additional buttons at the top of the tab: 'Install and Restart' (with a hammer icon), 'Check' (with a checklist icon), and 'More' (with a gear icon and an arrow indicating a pulldown menu). There is a magenta oval around the 'Install and Restart' button."  /&gt;

---
# Fully Operational!

* The package can be built and installed.
* Next Steps:
  - syncing to GitHub
  - adding DESCRIPTION info
  - adding data and code
  - adding documentation
  
---
class: inverse, middle, center

# Syncing to GitHub

---
# Why GitHub?

* Cloud-based backup of your new package
  - private repos are only visible to whom you give access to
* Supports installation from GitHub
  
  ```r
  remotes::install_github("{username}/{repo}")
  # remotes::install_github("ha0ye/myDemoPkg")
  ```
  - private repos, too, IF you have a personal access token (PAT) set up appropriately
  
---
# Setup (local)

* Install Git and register a GitHub account - https://happygitwithr.com/install-intro.html

* Create a Git repo for the project and make an initial commit

```r
usethis::use_git()
```

---
# Setup (GitHub, via `usethis`)

* Using a personal access token (PAT) that is setup with permissions to create repos

```r
usethis::use_github()
```

.center[OR]

---
# Setup (GitHub, manual)

* create a new repository
  - ideally same name as your package folder
  - choose public or private
  - SKIP initialization

* RStudio, click "New Branch" on the "Git"Pane

&lt;img src="rstudio_new-branch.png" title="A cropped screenshot of the 'Git' Pane in the RStudio interface, showing a panel with tabs for 'Files', 'Connections', 'Git', and 'Tutorial'. The 'Git' tab is selected, showing another row of buttons, including a button with an icon of a white diamond adjoined to 2 purple rectangles by straight lines. This button is centered in a magenta oval." alt="A cropped screenshot of the 'Git' Pane in the RStudio interface, showing a panel with tabs for 'Files', 'Connections', 'Git', and 'Tutorial'. The 'Git' tab is selected, showing another row of buttons, including a button with an icon of a white diamond adjoined to 2 purple rectangles by straight lines. This button is centered in a magenta oval."  /&gt;

---
# Setup (GitHub, manual)

* Click "Add Remote"
  - use `origin` for the "Remote Name"
  - copy-paste URL from GitHub (shown after creating new repo) for "Remote URL"

&lt;img src="rstudio_add-remote.png" title="A cropped screenshot of the 'Add Remote' dialog box in the RStudio interface, showing text boxes labeled 'Remote Name' and 'Remote URL', and buttons for 'Add' and 'Cancel'. The 'Remote Name' text box is filled with 'origin' and the 'Remote URL' text box is filled with 'git@github.com:ha0ye/myDemoPkg.git'" alt="A cropped screenshot of the 'Add Remote' dialog box in the RStudio interface, showing text boxes labeled 'Remote Name' and 'Remote URL', and buttons for 'Add' and 'Cancel'. The 'Remote Name' text box is filled with 'origin' and the 'Remote URL' text box is filled with 'git@github.com:ha0ye/myDemoPkg.git'"  /&gt;

---
# Setup (GitHub, manual)

* Choose the same "Branch Name" as your Git panel shows. 

&lt;img src="rstudio_branch-name.png" title="A cropped screenshot of the 'Git' Pane in the RStudio interface, showing a panel with tabs for 'Files', 'Connections', 'Git', and 'Tutorial'. The 'Git' tab is selected, showing another row of buttons, including a text label of 'Master' with a pulldown menu icon. The screenshot also contains a dialog box, labeled 'New Branch', with a textbox 'Branch Name' also containing 'Master', a selection menu labeled 'Remote', a button to 'Add Remote...', a checked check box labeled 'Sync box with remote', and two buttons labeled 'Create' and 'Cancel'." alt="A cropped screenshot of the 'Git' Pane in the RStudio interface, showing a panel with tabs for 'Files', 'Connections', 'Git', and 'Tutorial'. The 'Git' tab is selected, showing another row of buttons, including a text label of 'Master' with a pulldown menu icon. The screenshot also contains a dialog box, labeled 'New Branch', with a textbox 'Branch Name' also containing 'Master', a selection menu labeled 'Remote', a button to 'Add Remote...', a checked check box labeled 'Sync box with remote', and two buttons labeled 'Create' and 'Cancel'."  /&gt;
* Select "Overwrite" at the warning about a local branch already existing.

---
class: middle, center

# Demo

---
# Workflow

* update the package
* commit the changes
* push to GitHub

---
class: inverse, middle, center

# Updating DESCRIPTION

---
# Parts of a DESCRIPTION

* package name
* 1 sentence title
* version number
* package authors
* 1 paragraph description
* license
* dependencies

---
# Editing DESCRIPTION

* most fields can be filled out by hand (just once)
* a license determines how you allow other people to use it
  - usethis has defaults built-in:
  
  ```r
  usethis::use_mit_license()  
  ```
  - see also https://choosealicense.com/

---
# Adding Dependencies

* For functions other than those in the `base` package, the package needs to be listed as a dependency, and the package referred to by `{pkg}::{fun}`.

* The `use_package` function will add a package to the dependencies in `DESCRIPTION`.

```r
usethis::use_package("utils")
```

---
class: middle, center

# DEMO

---
class: inverse, middle, center

# Data and Code

---
class: inverse, middle, center

# Documentation



---
# Thanks

* Let me know what content you'd like to see
* Contact me for additional questions or consultation requests!
* Check back in on the libguide for more modules and contact info:
  - https://guides.uflib.ufl.edu/reproducibility
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
